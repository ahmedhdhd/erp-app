<div class="container-fluid">
  <!-- Page Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="mb-1">Employee Statistics</h2>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a routerLink="/dashboard" class="text-decoration-none">Dashboard</a>
          </li>
          <li class="breadcrumb-item">
            <a routerLink="/employees" class="text-decoration-none">Employees</a>
          </li>
          <li class="breadcrumb-item active">Statistics</li>
        </ol>
      </nav>
    </div>
    <button 
      type="button" 
      class="btn btn-outline-primary" 
      (click)="onRefresh()"
      [disabled]="isLoading">
      <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
      <i *ngIf="!isLoading" class="fas fa-sync-alt me-2"></i>
      {{ isLoading ? 'Loading...' : 'Refresh' }}
    </button>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2 text-muted">Loading employee statistics...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show" role="alert">
    <i class="fas fa-exclamation-triangle me-2"></i>{{ errorMessage }}
    <button type="button" class="btn-close" (click)="clearError()"></button>
  </div>

  <!-- Statistics Dashboard -->
  <div *ngIf="!isLoading && stats" class="stats-dashboard">
    
    <!-- Overview Cards -->
    <div class="row mb-4">
      <div class="col-lg-3 col-md-6 mb-3">
        <div class="stat-card primary">
          <div class="stat-icon">
            <i class="fas fa-users"></i>
          </div>
          <div class="stat-content">
            <h3>{{ formatNumber(stats.totalEmployees) }}</h3>
            <p>Total Employees</p>
          </div>
        </div>
      </div>
      
      <div class="col-lg-3 col-md-6 mb-3">
        <div class="stat-card success">
          <div class="stat-icon">
            <i class="fas fa-user-check"></i>
          </div>
          <div class="stat-content">
            <h3>{{ formatNumber(stats.activeEmployees) }}</h3>
            <p>Active Employees</p>
            <small class="percentage">{{ getActiveEmployeePercentage().toFixed(1) }}% of total</small>
          </div>
        </div>
      </div>
      
      <div class="col-lg-3 col-md-6 mb-3">
        <div class="stat-card warning">
          <div class="stat-icon">
            <i class="fas fa-user-minus"></i>
          </div>
          <div class="stat-content">
            <h3>{{ formatNumber(stats.inactiveEmployees) }}</h3>
            <p>Inactive Employees</p>
            <small class="percentage">{{ ((stats.inactiveEmployees / stats.totalEmployees) * 100).toFixed(1) }}% of total</small>
          </div>
        </div>
      </div>
      
      <div class="col-lg-3 col-md-6 mb-3">
        <div class="stat-card info">
          <div class="stat-icon">
            <i class="fas fa-dollar-sign"></i>
          </div>
          <div class="stat-content">
            <h3>{{ formatCurrency(stats.averageSalary) }}</h3>
            <p>Average Salary</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Growth Statistics -->
    <div class="row mb-4">
      <div class="col-lg-6 mb-3">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">
              <i class="fas fa-chart-line me-2"></i>Growth Statistics
            </h5>
          </div>
          <div class="card-body">
            <div class="growth-stat">
              <div class="growth-item">
                <div class="growth-label">New Employees This Month</div>
                <div class="growth-value success">{{ formatNumber(stats.newEmployeesThisMonth) }}</div>
              </div>
              <div class="growth-item">
                <div class="growth-label">New Employees This Year</div>
                <div class="growth-value info">{{ formatNumber(stats.newEmployeesThisYear) }}</div>
              </div>
              <div class="growth-item">
                <div class="growth-label">Monthly Growth Rate</div>
                <div class="growth-value" [ngClass]="getEmployeeGrowthPercentage() > 0 ? 'success' : 'danger'">
                  {{ getEmployeeGrowthPercentage().toFixed(1) }}%
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-lg-6 mb-3">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">
              <i class="fas fa-info-circle me-2"></i>Quick Insights
            </h5>
          </div>
          <div class="card-body">
            <div class="insight-item">
              <i class="fas fa-check-circle text-success me-2"></i>
              <span>{{ getActiveEmployeePercentage().toFixed(1) }}% of employees are currently active</span>
            </div>
            <div class="insight-item">
              <i class="fas fa-building text-info me-2"></i>
              <span>{{ Object.keys(stats.employeesByDepartment).length }} departments in total</span>
            </div>
            <div class="insight-item">
              <i class="fas fa-calendar-plus text-warning me-2"></i>
              <span>{{ stats.newEmployeesThisMonth }} new hires this month</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Department and Status Distribution -->
    <div class="row mb-4">
      <!-- Department Distribution -->
      <div class="col-lg-6 mb-3">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">
              <i class="fas fa-building me-2"></i>Distribution by Department
            </h5>
          </div>
          <div class="card-body">
            <div *ngIf="departmentChartData.length > 0" class="chart-container">
              <div *ngFor="let item of departmentChartData" class="chart-item">
                <div class="chart-label">
                  <span class="label-text">{{ item.name }}</span>
                  <span class="label-count">{{ item.value }} ({{ item.percentage }}%)</span>
                </div>
                <div class="chart-bar">
                  <div 
                    class="chart-fill" 
                    [style.width.%]="item.percentage">
                  </div>
                </div>
              </div>
            </div>
            <div *ngIf="departmentChartData.length === 0" class="text-center text-muted py-3">
              No department data available
            </div>
          </div>
        </div>
      </div>

      <!-- Status Distribution -->
      <div class="col-lg-6 mb-3">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">
              <i class="fas fa-chart-pie me-2"></i>Distribution by Status
            </h5>
          </div>
          <div class="card-body">
            <div *ngIf="statusChartData.length > 0" class="chart-container">
              <div *ngFor="let item of statusChartData" class="chart-item">
                <div class="chart-label">
                  <span class="label-text">{{ item.name }}</span>
                  <span class="label-count">{{ item.value }} ({{ item.percentage }}%)</span>
                </div>
                <div class="chart-bar">
                  <div 
                    class="chart-fill" 
                    [style.width.%]="item.percentage"
                    [style.background-color]="item.color">
                  </div>
                </div>
              </div>
            </div>
            <div *ngIf="statusChartData.length === 0" class="text-center text-muted py-3">
              No status data available
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Detailed Statistics Tables -->
    <div class="row">
      <!-- Department Details -->
      <div class="col-lg-6 mb-3">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">
              <i class="fas fa-list me-2"></i>Top Departments
            </h5>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Department</th>
                    <th class="text-center">Employees</th>
                    <th class="text-center">Percentage</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let dept of getTopDepartments()">
                    <td>
                      <i class="fas fa-building text-muted me-2"></i>
                      {{ dept.name }}
                    </td>
                    <td class="text-center">
                      <span class="badge bg-primary">{{ dept.employeeCount }}</span>
                    </td>
                    <td class="text-center">
                      {{ getDepartmentPercentage(dept.employeeCount).toFixed(1) }}%
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div *ngIf="departments.length === 0" class="text-center text-muted py-3">
              No department data available
            </div>
          </div>
        </div>
      </div>

      <!-- Position Details -->
      <div class="col-lg-6 mb-3">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">
              <i class="fas fa-users-cog me-2"></i>Top Positions
            </h5>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Position</th>
                    <th class="text-center">Employees</th>
                    <th class="text-end">Avg. Salary</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let pos of getTopPositions()">
                    <td>
                      <i class="fas fa-user-tie text-muted me-2"></i>
                      {{ pos.name }}
                    </td>
                    <td class="text-center">
                      <span class="badge bg-success">{{ pos.employeeCount }}</span>
                    </td>
                    <td class="text-end">
                      {{ formatCurrency(pos.averageSalary) }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div *ngIf="positions.length === 0" class="text-center text-muted py-3">
              No position data available
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- No Data Message -->
  <div *ngIf="!isLoading && !stats && !errorMessage" class="text-center py-5">
    <i class="fas fa-chart-bar text-muted" style="font-size: 4rem;"></i>
    <h4 class="text-muted mt-3">No Statistics Available</h4>
    <p class="text-muted">Unable to load employee statistics at this time.</p>
    <button type="button" class="btn btn-primary" (click)="onRefresh()">
      <i class="fas fa-sync-alt me-2"></i>Try Again
    </button>
  </div>
</div>