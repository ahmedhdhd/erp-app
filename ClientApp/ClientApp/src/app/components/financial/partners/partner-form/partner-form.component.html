<div class="container-fluid">
  <!-- Header Section -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h2 class="mb-2">
            <i class="fas fa-handshake"></i>
            {{ isEditMode ? 'Modifier le Partenaire' : 'Nouveau Partenaire' }}
          </h2>
          <p class="text-muted mb-0">
            {{ isEditMode ? 'Modifiez les informations du partenaire' : 'Créez un nouveau partenaire (client ou fournisseur)' }}
          </p>
        </div>
        <div class="btn-group" role="group">
          <button 
            type="button" 
            class="btn btn-outline-secondary" 
            (click)="onCancel()"
            [disabled]="saving">
            <i class="fas fa-times"></i>
            Annuler
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="row" *ngIf="loading">
    <div class="col-12 text-center">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Chargement...</span>
      </div>
      <p class="mt-2">Chargement du partenaire...</p>
    </div>
  </div>

  <!-- Error State -->
  <div class="row" *ngIf="errorMessage && !loading">
    <div class="col-12">
      <div class="alert alert-danger" role="alert">
        <i class="fas fa-exclamation-triangle"></i>
        {{ errorMessage }}
        <button type="button" class="btn btn-outline-danger btn-sm ms-2" (click)="isEditMode ? loadPartner() : onReset()">
          <i class="fas fa-redo"></i>
          Réessayer
        </button>
      </div>
    </div>
  </div>

  <!-- Success State -->
  <div class="row" *ngIf="successMessage">
    <div class="col-12">
      <div class="alert alert-success" role="alert">
        <i class="fas fa-check-circle"></i>
        {{ successMessage }}
      </div>
    </div>
  </div>

  <!-- Form Section -->
  <div class="row" *ngIf="!loading">
    <div class="col-lg-8 col-xl-6">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-info-circle me-2"></i>
            Informations du Partenaire
          </h5>
        </div>
        <div class="card-body">
          <form [formGroup]="partnerForm" (ngSubmit)="onSubmit()">
            <!-- Name and Code Fields -->
            <div class="row mb-3">
              <div class="col-md-8">
                <label class="form-label required">Nom du Partenaire</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="name"
                  placeholder="Ex: Société ABC"
                  [class.is-invalid]="isFieldInvalid('name')">
                <div class="invalid-feedback" *ngIf="isFieldInvalid('name')">
                  {{ getFieldError('name') }}
                </div>
              </div>
              <div class="col-md-4">
                <label class="form-label">Code</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="code"
                  placeholder="Ex: ABC001"
                  [class.is-invalid]="isFieldInvalid('code')">
                <div class="invalid-feedback" *ngIf="isFieldInvalid('code')">
                  {{ getFieldError('code') }}
                </div>
              </div>
            </div>

            <!-- Type and ICE Fields -->
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label required">Type de Partenaire</label>
                <select 
                  class="form-select" 
                  formControlName="type"
                  [class.is-invalid]="isFieldInvalid('type')">
                  <option *ngFor="let type of partnerTypes" [value]="type.value">
                    {{ type.label }}
                  </option>
                </select>
                <div class="invalid-feedback" *ngIf="isFieldInvalid('type')">
                  {{ getFieldError('type') }}
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">ICE</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="ice"
                  placeholder="Identifiant Commun de l'Entreprise"
                  [class.is-invalid]="isFieldInvalid('ice')">
                <div class="invalid-feedback" *ngIf="isFieldInvalid('ice')">
                  {{ getFieldError('ice') }}
                </div>
              </div>
            </div>

            <!-- Address Fields -->
            <div class="row mb-3">
              <div class="col-12">
                <label class="form-label">Adresse</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="address"
                  placeholder="Adresse complète"
                  [class.is-invalid]="isFieldInvalid('address')">
                <div class="invalid-feedback" *ngIf="isFieldInvalid('address')">
                  {{ getFieldError('address') }}
                </div>
              </div>
            </div>

            <!-- City, Postal Code, and Country Fields -->
            <div class="row mb-3">
              <div class="col-md-4">
                <label class="form-label">Ville</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="city"
                  placeholder="Ex: Tunis"
                  [class.is-invalid]="isFieldInvalid('city')">
                <div class="invalid-feedback" *ngIf="isFieldInvalid('city')">
                  {{ getFieldError('city') }}
                </div>
              </div>
              <div class="col-md-4">
                <label class="form-label">Code postal</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="postalCode"
                  placeholder="Ex: 1001"
                  [class.is-invalid]="isFieldInvalid('postalCode')">
                <div class="invalid-feedback" *ngIf="isFieldInvalid('postalCode')">
                  {{ getFieldError('postalCode') }}
                </div>
              </div>
              <div class="col-md-4">
                <label class="form-label">Pays</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="country"
                  placeholder="Ex: Tunisie"
                  [class.is-invalid]="isFieldInvalid('country')">
                <div class="invalid-feedback" *ngIf="isFieldInvalid('country')">
                  {{ getFieldError('country') }}
                </div>
              </div>
            </div>

            <!-- Contact Fields -->
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Téléphone</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="phone"
                  placeholder="Ex: +216 12 345 678"
                  [class.is-invalid]="isFieldInvalid('phone')">
                <div class="invalid-feedback" *ngIf="isFieldInvalid('phone')">
                  {{ getFieldError('phone') }}
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Email</label>
                <input 
                  type="email" 
                  class="form-control" 
                  formControlName="email"
                  placeholder="Ex: contact@societe.com"
                  [class.is-invalid]="isFieldInvalid('email')">
                <div class="invalid-feedback" *ngIf="isFieldInvalid('email')">
                  {{ getFieldError('email') }}
                </div>
              </div>
            </div>

            <!-- Tax and Credit Fields -->
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Numéro fiscal</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="taxNumber"
                  placeholder="Numéro d'identification fiscale"
                  [class.is-invalid]="isFieldInvalid('taxNumber')">
                <div class="invalid-feedback" *ngIf="isFieldInvalid('taxNumber')">
                  {{ getFieldError('taxNumber') }}
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Limite de crédit</label>
                <input 
                  type="number" 
                  class="form-control" 
                  formControlName="creditLimit"
                  placeholder="0.000"
                  step="0.001"
                  min="0"
                  [class.is-invalid]="isFieldInvalid('creditLimit')">
                <div class="invalid-feedback" *ngIf="isFieldInvalid('creditLimit')">
                  {{ getFieldError('creditLimit') }}
                </div>
              </div>
            </div>

            <!-- Status Field (only in edit mode) -->
            <div class="row mb-3" *ngIf="isEditMode">
              <div class="col-12">
                <label class="form-label">Statut</label>
                <div class="form-check form-switch">
                  <input 
                    class="form-check-input" 
                    type="checkbox" 
                    formControlName="isActive"
                    id="isActive">
                  <label class="form-check-label" for="isActive">
                    Partenaire actif
                  </label>
                </div>
                <div class="form-text">
                  Désactivez pour masquer le partenaire sans le supprimer
                </div>
              </div>
            </div>

            <!-- Form Actions -->
            <div class="row">
              <div class="col-12">
                <hr>
                <div class="d-flex justify-content-end gap-2">
                  <button 
                    type="button" 
                    class="btn btn-outline-secondary" 
                    (click)="onReset()"
                    [disabled]="saving">
                    <i class="fas fa-undo"></i>
                    Réinitialiser
                  </button>
                  <button 
                    type="button" 
                    class="btn btn-outline-primary" 
                    (click)="onCancel()"
                    [disabled]="saving">
                    <i class="fas fa-times"></i>
                    Annuler
                  </button>
                  <button 
                    type="submit" 
                    class="btn btn-primary" 
                    [disabled]="partnerForm.invalid || saving">
                    <i class="fas fa-save" [class.fa-spin]="saving"></i>
                    {{ saving ? 'Enregistrement...' : (isEditMode ? 'Mettre à jour' : 'Créer') }}
                  </button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Help Section -->
    <div class="col-lg-4 col-xl-6">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-question-circle me-2"></i>
            Aide
          </h5>
        </div>
        <div class="card-body">
          <h6>Types de Partenaires</h6>
          <ul class="list-unstyled small">
            <li><strong>Client:</strong> Entité à qui vous vendez des produits/services</li>
            <li><strong>Fournisseur:</strong> Entité de qui vous achetez des produits/services</li>
            <li><strong>Les deux:</strong> Entité qui est à la fois client et fournisseur</li>
          </ul>

          <h6 class="mt-3">Conseils</h6>
          <ul class="list-unstyled small">
            <li>• Le code est optionnel mais recommandé pour l'identification</li>
            <li>• L'ICE est requis pour les entreprises tunisiennes</li>
            <li>• La limite de crédit permet de contrôler les risques</li>
            <li>• Les partenaires inactifs ne sont pas supprimés</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>